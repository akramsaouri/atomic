<html>
    <head>
        <title>Atomic-demo</title>
        <script src="./atomic.js"></script>
    </head>
    <body>
        <buy-button sku="sdsds" price="66.00"></buy-button>
        <cart-info></cart-info>
        <script>
            class BlueBuy extends Atomic {
                addToCart() {
                    const sku = this.getAttribute("sku");
                    const price = this.getAttribute("price");
                    this.signal("add-to-cart", { sku, price });
                }

                render() {
                    const sku = this.getAttribute("sku") || "";
                    const price = this.getAttribute("price") || "0.00";
                    return `<button type="button" data-event="click:addToCart">Buy for ${price} € (SKU: ${sku}) (test signal)</button>`;
                }
            }

            class CartInfo extends Atomic {
                atom = {
                    cartItems: [],
                };

                subscribers = [{ name: "add-to-cart", cb: this.updateCart }];

                updateCart(event) {
                    const { sku, price } = event.detail;
                    this.setAtom({
                        cartItems: [...this.atom.cartItems, { sku, price }],
                    });
                }

                clearCart() {
                    this.setAtom({
                        cartItems: [],
                    });
                }

                render() {
                    const { cartItems } = this.atom;
                    const cartContent = cartItems.length
                        ? cartItems
                              .map(
                                  (item) =>
                                      `<li>SKU: ${item.sku}, Price: ${item.price} €</li>`
                              )
                              .join("")
                        : "<li>Cart is empty</li>";

                    return `
                        <div>
                            <h3>Cart Contents:</h3>
                            <ul>${cartContent}</ul>
                            <button data-event="click:clearCart">Clear Cart</button>
                        </div>
                    `;
                }
            }

            window.customElements.define("cart-info", CartInfo);
            window.customElements.define("buy-button", BlueBuy);

            // Parent document event listener (optional, for demonstration)
            document.addEventListener("add-to-cart", (event) => {
                const { sku, price } = event.detail;
                console.log(
                    `Event caught in parent: SKU ${sku} for ${price} €`
                );
            });
        </script>
        <button
            onclick="document.querySelector('buy-button').setAttribute('sku', Math.random().toString(36).substring(7))"
        >
            Change SKU (test attributeChangedCallback)
        </button>
    </body>
</html>
